<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>SiCLO · Geoportal Interrapidísimo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- MapLibre -->
  <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"/>

  <!-- Tipografía -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Inter', system-ui, sans-serif;
      background: #0b0f14;
      color: #e5e7eb;
    }

    #map {
      position: absolute;
      inset: 0;
    }

    .welcome {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #0f172a, #020617);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .welcome-card {
      width: 420px;
      max-width: 90%;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(14px);
      border-radius: 18px;
      padding: 32px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
      text-align: center;
    }

    .panel {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 320px;
      background: rgba(15, 23, 42, 0.92);
      backdrop-filter: blur(12px);
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.45);
      z-index: 10;
    }

    .layer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .maplibregl-popup-content {
      background: #020617;
      color: #e5e7eb;
      border-radius: 10px;
      padding: 12px 14px;
    }
  </style>
</head>

<body>

<div class="welcome" id="welcome">
  <div class="welcome-card">
    <h1>SiCLO</h1>
    <p>Sistema de Integración Comercial y Logístico</p>
    <input type="password" id="password" placeholder="Contraseña de acceso" />
    <button onclick="login()">Ingresar</button>
    <div id="error" style="display:none;color:#f87171;font-size:12px;">Contraseña incorrecta</div>
  </div>
</div>

<div id="map"></div>

<div class="panel">
  <h1>SiCLO</h1>

  <div class="layer">
    <span>Mapa base</span>
    <select id="basemap">
      <option value="nav">Navegación</option>
      <option value="sat">Satelital</option>
    </select>
  </div>
</div>

<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>

<script>
  // ===== LOGIN =====
  const PASSWORD = "siclo2026";

  function login() {
    const input = document.getElementById("password").value;
    if (input === PASSWORD) {
      document.getElementById("welcome").style.display = "none";
    } else {
      document.getElementById("error").style.display = "block";
    }
  }

  // ===== MAPA =====
  const map = new maplibregl.Map({
    container: 'map',
    style: {
      version: 8,
      sources: {
        nav: {
          type: 'raster',
          tiles: ['https://a.tile.openstreetmap.org/{z}/{x}/{y}.png'],
          tileSize: 256
        },
        sat: {
          type: 'raster',
          tiles: ['https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'],
          tileSize: 256
        }
      },
      layers: [
        { id: 'basemap-nav', type: 'raster', source: 'nav', layout: { visibility: 'visible' } },
        { id: 'basemap-sat', type: 'raster', source: 'sat', layout: { visibility: 'none' } }
      ]
    },
    center: [-74.08175, 4.60971],
    zoom: 12
  });

  map.addControl(new maplibregl.NavigationControl(), 'top-right');

  // ===== CAMBIO MAPA BASE =====
  document.getElementById('basemap').onchange = (e) => {
    const isSat = e.target.value === 'sat';
    map.setLayoutProperty('basemap-nav', 'visibility', isSat ? 'none' : 'visible');
    map.setLayoutProperty('basemap-sat', 'visibility', isSat ? 'visible' : 'none');
  };

  // ===== EJEMPLO DE CARGA GEOJSON (luego lo reemplazas por el tuyo) =====
  map.on('load', async () => {
    const geojson = await fetch('data/recorrido_360.geojson').then(r => r.json());

    map.addSource('recorrido', {
      type: 'geojson',
      data: geojson
    });

    map.addLayer({
      id: 'recorrido-points',
      type: 'circle',
      source: 'recorrido',
      paint: {
        'circle-radius': 6,
        'circle-color': '#38bdf8',
        'circle-stroke-width': 1.5,
        'circle-stroke-color': '#020617'
      }
    });
  });
</script>

</body>
</html>
